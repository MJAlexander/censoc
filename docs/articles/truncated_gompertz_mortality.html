<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Truncated Gompertz mortality estimation by cohort and birthplace • censoc</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Truncated Gompertz mortality estimation by cohort and birthplace">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">censoc</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bfdw_variables.html">Variables in CenSoc for BFDW</a>
    </li>
    <li>
      <a href="../articles/censoc_chapter.pdf">Deaths without denominators: using a matched dataset to study mortality patterns in the United States (PDF)</a>
    </li>
    <li>
      <a href="../articles/ipums_document.html">Obtaining the full count 1940 census from IPUMS to use with CenSoc</a>
    </li>
    <li>
      <a href="../articles/ipums_merge.html">Merging full count 1940 census from IPUMS with CenSoc Data</a>
    </li>
    <li>
      <a href="../articles/match_document.html">Documentation for CenSoc Dataset</a>
    </li>
    <li>
      <a href="../articles/truncated_gompertz_mortality.html">Truncated Gompertz mortality estimation by cohort and birthplace</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/MJAlexander/censoc">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Truncated Gompertz mortality estimation by cohort and birthplace</h1>
            
            <h4 class="date">2018-11-14</h4>
      
      <small class="dont-index">Source: <a href="http://github.com/MJAlexander/censoc/blob/master/vignettes/truncated_gompertz_mortality.Rmd"><code>vignettes/truncated_gompertz_mortality.Rmd</code></a></small>
      <div class="hidden name"><code>truncated_gompertz_mortality.Rmd</code></div>

    </div>

    
    
<p>As the observed deaths in the CenSoc dataset are truncated to be within a certain age range which varies across cohorts, any comparison across mortality cohorts will be misleading. The dataset must be adjusted for the truncation. Fortunately, a Bayesian truncated Gompertz model can be used for this dataset.</p>
<p>This vignette presents useful tools from the <code>censoc</code> R package and demonstrates an application of the Bayesian truncated Gompertz model. For this case, the example will be an estimation of life expectancy at age 65 (i.e. the average years left to live at age 65) by cohort and place of birth, for cohorts 1895-1915 using the CenSoc dataset.</p>
<p>For more information: <a href="https://censoc.demog.berkeley.edu/">CenSoc project</a>, <a href="https://censoc.demog.berkeley.edu/articles/match_document.html">dataset details</a> and the <a href="https://censoc.demog.berkeley.edu/articles/censoc_chapter.pdf">Bayesian truncated Gompertz model</a>.</p>
<div id="short-example-code" class="section level2">
<h2 class="hasAnchor">
<a href="#short-example-code" class="anchor"></a>Short example code:</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(data.table)
<span class="kw">library</span>(rjags)
<span class="kw">library</span>(R2jags)
<span class="kw">library</span>(censoc)</code></pre></div>
<div id="variables-and-death-counts" class="section level4">
<h4 class="hasAnchor">
<a href="#variables-and-death-counts" class="anchor"></a>Variables and death counts</h4>
<p>After loading the necessary packages and data, create age of death and race categories variables using functions from the <code>censoc</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Variables</span>
df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_age_of_death_column.html">add_age_of_death_column</a></span>(df) <span class="co">#age of death</span>
df$bpl_cat &lt;-<span class="st"> </span><span class="ot">NA</span> <span class="co">#Reducing natinality into fewer categories in a new variable</span>
df$bpl_cat[df$BPL&lt;=<span class="st"> </span><span class="dv">09900</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co">#"Native"</span>
df$bpl_cat[df$BPL ==<span class="st"> </span><span class="dv">45300</span>] &lt;-<span class="dv">2</span> <span class="co">#Germany</span>
df$bpl_cat[<span class="kw">is.na</span>(df$bpl_cat)] &lt;-<span class="dv">3</span> <span class="co"># Rest of the world</span>
<span class="co"># Tabulating the deaths:</span>
tab_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tabulate_deaths.html">tabulate_deaths</a></span>(df, bpl_cat)
tab_df$bpl_label &lt;-<span class="st"> </span><span class="ot">NA</span> <span class="co"># defining the labels for each race category</span>
tab_df$bpl_label[tab_df$bpl_cat==<span class="dv">1</span>] &lt;-<span class="st"> "USA"</span>
tab_df$bpl_label[tab_df$bpl_cat==<span class="dv">2</span>] &lt;-<span class="st"> "Germany"</span>
tab_df$bpl_label[tab_df$bpl_cat==<span class="dv">3</span>] &lt;-<span class="st"> "Rest of the world"</span>
cohorts &lt;-<span class="st"> </span><span class="dv">1895</span>:<span class="dv">1915</span>
tab_df &lt;-<span class="st"> </span><span class="kw">filter</span>(tab_df, byear %in%<span class="st"> </span>cohorts) <span class="co"># data only contains these cohorts</span></code></pre></div>
</div>
<div id="running-the-model" class="section level4">
<h4 class="hasAnchor">
<a href="#running-the-model" class="anchor"></a>Running the model</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">min_age &lt;-<span class="st"> </span><span class="dv">65</span>
meta_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_meta_data.html">get_meta_data</a></span>(tab_df, min_age)
group_labels &lt;-<span class="st"> </span>meta_data$group_labels
<span class="co"># Model</span>
mod &lt;-<span class="st"> </span><span class="kw"><a href="../reference/truncated_gompertz_model.html">truncated_gompertz_model</a></span>(tab_df, min_age, <span class="dt">number_chains =</span> <span class="dv">4</span>, <span class="dt">number_iterations =</span> <span class="dv">4000</span>, <span class="dt">run_in_parallel =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## Processing data into JAGS format. 
## Running model. 
## Model finished. 
## Maximum Rhat is 1.2362057034082.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Life expectancy (ex) and hazard rate (hx) estimates</span>
res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_estimated_hx_ex.html">get_estimated_hx_ex</a></span>(mod, ncohorts, ngroups, group_labels, nages, <span class="dt">alpha_level =</span> <span class="fl">0.05</span>)
ex_df &lt;-<span class="st"> </span>res$ex_df <span class="co"># extract life expectancy dataframe</span></code></pre></div>
</div>
<div id="results-life-expectancy-at-age-65-by-place-of-birth-and-cohort" class="section level4">
<h4 class="hasAnchor">
<a href="#results-life-expectancy-at-age-65-by-place-of-birth-and-cohort" class="anchor"></a>Results: life expectancy at age 65 by place of birth and cohort</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">group_title &lt;-<span class="st"> "Place of birth"</span>
ex_age &lt;-<span class="st"> </span><span class="dv">65</span><span class="co"># Age of life expectancy to be plotted </span>
<span class="co">#Plot</span>
<span class="kw"><a href="../reference/plot_ex.html">plot_ex</a></span>(ex_df, ex_age, group_title)</code></pre></div>
<p><img src="truncated_gompertz_mortality_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="important-comments" class="section level3">
<h3 class="hasAnchor">
<a href="#important-comments" class="anchor"></a>Important comments</h3>
<ul>
<li><p>Please refer to IPUMS documentation Census variables codes.</p></li>
<li><p>As many categories of a variable can be included. However, the categories must be sequentially numbered for the model to run.</p></li>
<li><p>This example used the cohort born between 1895 and 1915. The cohort may be modified to include any years between 1865 to 1940.</p></li>
<li><p>Computationally, the minimum age can be as low as 0. However, in terms of the Gompertz mortality model, we are interested in adults. So, <code>min_age</code> should be greater than <code>insert AGE</code>.</p></li>
<li><p>The maximum age is not set by the user, it its fixed at 110. However, setting <code>ex_age</code> at 110 will yield a graph with no useful results.</p></li>
<li><p>For the <code>truncated_gompertz_model</code> function to work, the <code>tab_df</code> must follow the ordering used above. In particular, the third column must be a number referring to the group level. The fifth column must be a label for each group.</p></li>
<li><p>For the model to converge, the value of “Rhat” must be 1.1 or lower. If your model did not converge, try running it for more iterations. <strong>NOTE: Model run time can be quite long. In this case, for 4,000 iterations it could take 3 minutes using 3 place of birth categories. However, increasing the number of iterations or the categories, increases the run time..</strong></p></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#short-example-code">Short example code:</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Monica Alexander, Joshua Goldstein.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
